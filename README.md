# Общие требования к прошивке

### Общее описание:
Требуется прошивка для системы устройств, состоящей из сканера RFID меток (через COM-port) и шлагбаума. Также прошивка должна иметь возможность отправлять и принимать HTTP запросы на/от ниже описанных endpoint-в. Краткое описание деятельности системы: сканер RFID меток сканирует метку, дальше информация от сканера должна поступать на сервер для проверки валидности данной RFID метки, поступать через HTTP запрос в качестве event. При успешном выполнении запроса прошивка должна открывать шлагбаум и пропускать машину, которая приехала на территорию. Также существуют негативные кейсы, например отсутствие RFID метки в базе данных на сервере или неисправность шлагбаума и тд. Для случаев критической неисправности каких то устройств в системе существует endpoint "/api/report", в который можно сообщить какое устройство вышло из строя.

основные требования к ядру:

1. принимает и посылает запросы на backend и с backend(протокол http)
2. регистрирует и хранит у себя актуальное состояние подчиняющих устройств, которые подключены в систему и входят в одну группу
3. не знает о том какой формат данных надо принимать, просто роутит на соответствующий сателит, формирование json и его валидация происходит непосредственно на самом подчиняющемся модуле
4. имеет уникальный номер группы, в которую входят slave устройства
5. работает в многопоточном режиме(по возможности).

![wewwwewe](https://user-images.githubusercontent.com/71149808/130666489-4354306e-6d53-4ee1-bc1f-bbb209ed042f.png)


### Необходимые требования:
1. Возможность тестировать функциональность прошивки локально с адресом платы localhost:8181 (или в качестве аргументов при запуске самостоятельно передавать host и port)
2. В случае если плата переживает экстренное выключение питания и программа приостанавливается, желательно посылать в "/api/report" ID устройства.


# Документация к API

### Регистрация платы внутри программы - `POST device-registration-core/api/registration` - запрос с платы на сервер
Метод предназначенный для регистрации платы в нашей программе для дальнейшей идентификации плат и подконтрольных им устройств во время работы. Внутри платы должен быть флажок, что плата зарегистрирована, и плата должна совершать запросы на сервер до тех пор, пока не зарегистрируется успешно. В ответ на запрос будет прислано число, которое ядро должно запомнить. Это число будет означать номер, который backend присвоит для данной группы, ответ также будет дан в формате JSON. Может существовать кейс, в ходе которого какое-то из устройств не будет отвечать на позывные от ядра, в этом случае, ядро должно продолжить опрашивать это устройство и при этом зарегистрировать уже найденные устройства. Как только отсутствующее устройство откликнется, нужно сделать новый запрос на регистрацию включив в массив новое устройство (но не исключая уже зарегистрированные). 

![ErrorRegister](https://user-images.githubusercontent.com/71149808/130667622-c3494e9a-94db-49a1-aeec-cfb6e6914d04.png)
![ReRegister](https://user-images.githubusercontent.com/71149808/130667670-8fdfbe6c-01a8-4f4e-bc5b-e4ecad13fef0.png)

**Список параметров:**
`@RequestBody BoardRegisterDto` - объект, содержащий 3 поля:
http_address - адрес платы, в строчном формате, например "http://192.168.0.100:8080",
device_id - идентификатор устройства,
coordinates - координаты платы в формате строки: "55.993651, 37.183600"

**Формат запроса:**
```
{
     "group": число в формате long, при первой регистрации null
     "address" :  "192.168.10.98:8080",
     “groups”: [
	    {
            	"id": 1234657,
            	"type" : ”RFID"
	    },
	    {
		"id": 87654428,
		"type" : “ENTRY"
	    }
    ]
}
```

**Формат ответа:**
```sh
{
    "group_id": уникальный идентификатор группы, long,
}
```
HTTP Status 200 - в случае успешной регистрации,
HTTP Status 400 - в случае неудачной регистрации.

---
Примечания: Если в ответ на запрос получен статус 500, то рекомендуется сделать еще несколько попыток запроса.
